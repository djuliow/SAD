generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  role      Role
  password  String
  schedules Schedule[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  ADMIN
  DOKTER
  APOTEKER
  KEPALA
}

model Patient {
  id              String        @id @default(cuid())
  medicalRecordNo String        @unique
  name            String
  dob             DateTime
  gender          String
  phone           String
  address         String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  queues          Queue[]
  examinations    Examination[]
  payments        Payment[]
}

model Queue {
  id          String       @id @default(cuid())
  patient     Patient      @relation(fields: [patientId], references: [id])
  patientId   String
  doctor      User?        @relation(fields: [doctorId], references: [id])
  doctorId    String?
  status      QueueStatus  @default(PENDING)
  scheduledAt DateTime
  createdAt   DateTime     @default(now())
  examination Examination?
}

enum QueueStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model Examination {
  id            String        @id @default(cuid())
  patient       Patient       @relation(fields: [patientId], references: [id])
  patientId     String
  doctor        User          @relation(fields: [doctorId], references: [id])
  doctorId      String
  queue         Queue?        @relation(fields: [queueId], references: [id])
  queueId       String?
  complaint     String
  diagnosis     String
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  prescriptions Prescription[]
}

model Prescription {
  id             String      @id @default(cuid())
  examination    Examination @relation(fields: [examinationId], references: [id])
  examinationId  String
  medicine       Medicine    @relation(fields: [medicineId], references: [id])
  medicineId     String
  dosage         String
  frequency      String
  duration       String
  sentToPharmacy Boolean     @default(false)
  createdAt      DateTime    @default(now())
}

model Medicine {
  id          String        @id @default(cuid())
  name        String
  category    String
  description String?
  stocks      Stock[]
  prescriptions Prescription[]
}

model Stock {
  id         String   @id @default(cuid())
  medicine   Medicine @relation(fields: [medicineId], references: [id])
  medicineId String
  quantity   Int
  updatedAt  DateTime @updatedAt
}

model Payment {
  id         String   @id @default(cuid())
  patient    Patient  @relation(fields: [patientId], references: [id])
  patientId  String
  amount     Float
  method     String
  status     PaymentStatus @default(PENDING)
  createdAt  DateTime @default(now())
  report     Report?
}

enum PaymentStatus {
  PENDING
  PAID
  VOID
}

model Report {
  id         String    @id @default(cuid())
  period     String
  type       ReportType
  generatedAt DateTime @default(now())
  payments   Payment[]
}

enum ReportType {
  DAILY
  MONTHLY
}

model Schedule {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  role      Role
  day       String
  shift     String
  createdAt DateTime @default(now())
}
